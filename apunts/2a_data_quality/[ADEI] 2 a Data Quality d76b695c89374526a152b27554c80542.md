# [ADEI] 2.a. Data Quality

# Data Quality

## Data growth rate

![%5BADEI%5D%202%20a%20Data%20Quality%20d76b695c89374526a152b27554c80542/Screenshot_2020-09-18_at_15.23.57.png](%5BADEI%5D%202%20a%20Data%20Quality%20d76b695c89374526a152b27554c80542/Screenshot_2020-09-18_at_15.23.57.png)

The past two decades has seen a dramatic increase in the amount of information or data being stored in electronic format. This accumulation of data has taken place at an explosive rate. It has been estimated that the amount of information in the world doubles every 20 months and the size and number of databases are increasing even faster.

QUALITY of stored data is a fundamental issue

## Aspects of data quality

- Problems with data:
    - Redundancy (duplicated information across DDBB)
    - Inconsistencies: changes in names, addresses, telephone numbers, email addresses (perishing validity) ...
    - Application-data dependence, lack of flexibility,
    - Inability to share data among applications.
    - Errors, incorrect data
    - Outliers, unusual values for a given data (bias the results)
    - Missing data, non coded data.... (non response: total, partial)
- Effects of low data quality:
    - Loose of accuracy, waste of money, reduction of data size, poor result precision,
    increment of variability, ...

From a statistical point of view, we can only treat outliers and missing data

## **Outliers**

What is an outlier? Definition of Douglas Hawkins: “An outlier is an observation which deviates so much from the other observations as to arouse suspicions that it was generated by a different mechanism”

Statistics-based intuition. Normal data follow a “normal generating data mechanism”, e.g.
some given statistical process. Outlying data may be a:

- very unlikely events for the normal generating mechanism
- data following a different generating mechanism

![%5BADEI%5D%202%20a%20Data%20Quality%20d76b695c89374526a152b27554c80542/Screenshot_2020-09-18_at_15.27.20.png](%5BADEI%5D%202%20a%20Data%20Quality%20d76b695c89374526a152b27554c80542/Screenshot_2020-09-18_at_15.27.20.png)

## Example: Hadlum vs. Hadlum (1949) [Barnett 1978]

- The birth of a child to Mrs. Hadlum happened 349 days after Mr. Hadlum left for military service.
- Average human gestation period is 280 days (40 weeks).
- Statistically, 349 days is an outlier.

![%5BADEI%5D%202%20a%20Data%20Quality%20d76b695c89374526a152b27554c80542/Screenshot_2020-09-18_at_15.28.07.png](%5BADEI%5D%202%20a%20Data%20Quality%20d76b695c89374526a152b27554c80542/Screenshot_2020-09-18_at_15.28.07.png)

![%5BADEI%5D%202%20a%20Data%20Quality%20d76b695c89374526a152b27554c80542/Screenshot_2020-09-18_at_15.29.08.png](%5BADEI%5D%202%20a%20Data%20Quality%20d76b695c89374526a152b27554c80542/Screenshot_2020-09-18_at_15.29.08.png)

blue: statistical basis (13634 observations of gestation periods)

green: assumed underlying Gaussian process. Very low probability for the birth of Mrs. Hadlums child for being generated by this process

red: assumption of Mr. Hadlum: Another Gaussian process responsible for the observed
birth, where the gestation period starts later. Under this assumption the specific
birthday has highest-probability.

## **Example of an Outlier in data**

- The data set of N=90 ordered observations as shown below is examined for outliers:

30, 171, 184, 201, 212, 250, 265, 270, 272, 289, 305, 306, 322, 322, 336, 346, 351, 370, 390, 404, 409, 411, 436, 437, 439, 441, 444, 448, 451, 453, 470, 480, 482, 487, 494, 495, 499, 503, 514, 521, 522, 527, 548, 550, 559, 560, 570, 572, 574, 578, 585, 592, 592, 607, 616, 618, 621, 629, 637, 638, 640, 656, 668, 707, 709, 719, 737, 739, 752, 758, 766, 792, 792, 794, 802, 818, 830, 832, 843, 858, 860, 869, 918, 925, 953, 991, 1000, 1005, 1068, 1441

![%5BADEI%5D%202%20a%20Data%20Quality%20d76b695c89374526a152b27554c80542/Screenshot_2020-09-18_at_15.31.03.png](%5BADEI%5D%202%20a%20Data%20Quality%20d76b695c89374526a152b27554c80542/Screenshot_2020-09-18_at_15.31.03.png)

histograma

- Estadística Descriptiva A? : unvariant
    - graphics
        - quantitativa/numèrica
            - histograma: `hist(var, 15, main="...")`
            - boxplot: `boxplot(var, main="...")`
        - qualitativa/factor
            - barres: `barplot(table())`
            - ~~pastís: `pie(...)`~~
    - numèriques
        - `summary(df)`
            - serveix per quantitatives com qualitatives
        - estadístics (quantitatives)
            - tendència central
                - `mean(x)` (mitjana, media)
                - `median(x)` (mediana → valor percentil 50%)
            - dispersió
                - estàndard deviation
                - variance (estàndard deviation ^2)
                - inter quartiler range: `IQR = Q3-Q1`
    - representació
        - es necessita estructura bidimensional anomenat **data frame (df)**
            - columnes: variabes / features
            - files: dades

## Discussion of the Hadlum vs. Hadlum case

1. Data is usually ***multivariate***, i.e., multi-dimensional, whereas => basic model is assumed to be univariate, i.e., 1-dimensional
2. There is usually ***more than one generating*** mechanism/statistical process underlying the “normal” data; => basic model assumes only one “normal” generating mechanism, where outliers are rare observations. Outliers may represent a different class (generating mechanism) of objects, so there may be a large class of similar objects that are the outliers.

***Outliers are multivariate***

Univariate detection of outliers doesn’t imply multivariate detection

![%5BADEI%5D%202%20a%20Data%20Quality%20d76b695c89374526a152b27554c80542/Screenshot_2020-09-18_at_15.32.28.png](%5BADEI%5D%202%20a%20Data%20Quality%20d76b695c89374526a152b27554c80542/Screenshot_2020-09-18_at_15.32.28.png)

outlier bivariant

## Univariate detection of outliers. The Boxplot

The Boxplot (Tukey, 1977) is a graphical display for exploratory data analysis, where the outliers appear tagged. Two types of outliers are distinguished: *mild* outliers and *extreme* outliers.

![%5BADEI%5D%202%20a%20Data%20Quality%20d76b695c89374526a152b27554c80542/Untitled.png](%5BADEI%5D%202%20a%20Data%20Quality%20d76b695c89374526a152b27554c80542/Untitled.png)

percentiles

- An observation *x* is declared an extreme outlier, if it lies outside of the interval ***(Q1-3***×***IQR, Q3+3***×***IQR)**,* where *IQR=Q3-Q1* is called the *Interquartile Range*.
- An observation *x* is declared a mild outlier if it lies outside of the interval ***(Q1-1.5***×***IQR, Q3+1.5***×***IQR)**.*

The numbers *1.5* and *3* are chosen by comparison with a normal distribution. If *x ~ Normal :*

- *Prob(X*≥ *Q3+1.5*×*IQR)= 0.003488302*
- *Prob(X*≥ *Q3+3*×*IQR)= 1.170971e-06*

![%5BADEI%5D%202%20a%20Data%20Quality%20d76b695c89374526a152b27554c80542/Screenshot_2020-09-18_at_15.33.57.png](%5BADEI%5D%202%20a%20Data%20Quality%20d76b695c89374526a152b27554c80542/Screenshot_2020-09-18_at_15.33.57.png)

![%5BADEI%5D%202%20a%20Data%20Quality%20d76b695c89374526a152b27554c80542/iu.png](%5BADEI%5D%202%20a%20Data%20Quality%20d76b695c89374526a152b27554c80542/iu.png)

iqr

## Practice of detecting outliers

- To obtain unbiased results in any statistical/learning algorithm. Including outliers in the training data may invalidate the results.
- Once we have detected outliers, what we should do?
    - Eliminate them (but we loose information of the eliminated individuals) and deleting outliers is not the best solution, since outliers are recursive.
    - Weight the individuals inversely to outlying degree of individuals, to diminish its importance (but statistical/learning methods would need to had implemented  weighing option of individuals).
    - Make robust estimation of the parameters of the “normal generating mechanism”, for instance with a given percentage of the “central” individuals.
    - Declare outliers as “missing values” and treat them as missing data.
- Detecting “rare” events
    - Fraud detection,
    - Detecting network intrusion
    - Detecting changes in the behavior (sales, claims, connections, waiting time, ...)

## The missing data problem

*Typical data set:
Some information is missing for some variables and for some cases.*

![%5BADEI%5D%202%20a%20Data%20Quality%20d76b695c89374526a152b27554c80542/Screenshot_2020-09-18_at_15.38.27.png](%5BADEI%5D%202%20a%20Data%20Quality%20d76b695c89374526a152b27554c80542/Screenshot_2020-09-18_at_15.38.27.png)

Analysis is just designed for complete data sets (standard methods will fail)

## **Missing data**

- **Databases:**
    - Databases are used for secondary purposes, only information which is currently used is maintained. (i.e. in land registries, addresses are the best up to data field, the characteristics of the premises much less).
    - Not compulsory fields.
    - Errors and outliers as missing values ...
- **Surveys:**
    - Outright refusals: unit nonresponse → (reweighing the sample)
    - Non response to some items : item nonresponse → (dealing with missings) (it depends on the data collection method: internet, telephone, mail, face to face)
    - Inapplicable questions to some respondents
    - Dropouts in panel studies

Serious drawback of the data quality (values not recorded, not consistent, ...)

**Missingness is a nuisance**

## Is missing data a problem

1. Ignoring missing data can seriously bias the results
2. Missing data represents a loss of information (waste of resources)
3. The impact of missing data depends on its generating mechanism (why some values are missing?)

***The best policy to deal with missing data is to avoid them with careful planning of data collection, with proper intelligent interfaces.***

## Exploring the missingness

**Before to start. Identify the missing data**

Usual convention:

Assign a missing code to continuous variables (NA, -1, 999999, ...)

Assign a new category (missing) to a categorical variable.

**Check the quality of the information**

Count the number of missing per variable and rank them accordingly.

The more the missings the less reliable is the *information* provided by the variable

**Characterize the missingness mechanism**

Create a new variable counting the number of missing per individual.

Describe this variable (association analysis).

Describe the missing categories by multidimensional methods (missing values form a specific category)

## Missingness mechanisms

- MCAR - `Completely at random`:
    - missing values appear without any pattern. This is the most favorable situation, missing values just implies a reduction of the size.
- MAR - `At random`:
    - missing values appear related to third observed variables. This is the most usual case, i.e. asking the income of individuals, income is missing but can be imputed from the educational level.
- MNAR - `Not at random`:
    - missing values depend on the missing variable itself. This is the most difficult case. In the previous example it would be that high incomes tend to not declare it.

        *Exemple: preguntar què guanyen → qui guanya més no ho dirà*

## Treatment of missing values

![%5BADEI%5D%202%20a%20Data%20Quality%20d76b695c89374526a152b27554c80542/Screenshot_2020-09-18_at_16.24.37.png](%5BADEI%5D%202%20a%20Data%20Quality%20d76b695c89374526a152b27554c80542/Screenshot_2020-09-18_at_16.24.37.png)

- Traditional methods
    - **Listwise deletion**.
        - Every individual with a missing value is deleted (loose of information, biasing the results (except in MCAR))
        - Només la podem fer si és el target
    - **Unconditional mean imputation**.
        - Every missing value is substituted by the corresponding global mean of the variable
    - **Regression imputation**.
        - Every missing value is substituted by the predicted value from a multiple regression.
        - No té en compte variabilitat

![%5BADEI%5D%202%20a%20Data%20Quality%20d76b695c89374526a152b27554c80542/Screenshot_2020-09-18_at_16.26.24.png](%5BADEI%5D%202%20a%20Data%20Quality%20d76b695c89374526a152b27554c80542/Screenshot_2020-09-18_at_16.26.24.png)

- Stochastic imputation (imputare = to fill in)
- Simulate actual data

    ![%5BADEI%5D%202%20a%20Data%20Quality%20d76b695c89374526a152b27554c80542/Screenshot_2020-09-18_at_16.27.17.png](%5BADEI%5D%202%20a%20Data%20Quality%20d76b695c89374526a152b27554c80542/Screenshot_2020-09-18_at_16.27.17.png)

- Stochastic regression imputation

    ![%5BADEI%5D%202%20a%20Data%20Quality%20d76b695c89374526a152b27554c80542/Screenshot_2020-09-18_at_16.27.51.png](%5BADEI%5D%202%20a%20Data%20Quality%20d76b695c89374526a152b27554c80542/Screenshot_2020-09-18_at_16.27.51.png)

![%5BADEI%5D%202%20a%20Data%20Quality%20d76b695c89374526a152b27554c80542/Screenshot_2020-09-18_at_16.28.08.png](%5BADEI%5D%202%20a%20Data%20Quality%20d76b695c89374526a152b27554c80542/Screenshot_2020-09-18_at_16.28.08.png)

**Knn** – K nearest neighbor imputation (easy to implement)

- For every individual containing a missing value in a specific variable, we find another individual with minimal distance to the previous one and with complete information.
- Then transfer (copy) the value of the specific variable, of the second individual to the first one.

![%5BADEI%5D%202%20a%20Data%20Quality%20d76b695c89374526a152b27554c80542/Screenshot_2020-09-18_at_16.30.08.png](%5BADEI%5D%202%20a%20Data%20Quality%20d76b695c89374526a152b27554c80542/Screenshot_2020-09-18_at_16.30.08.png)

## Knn imputation

![%5BADEI%5D%202%20a%20Data%20Quality%20d76b695c89374526a152b27554c80542/Screenshot_2020-09-18_at_16.31.19.png](%5BADEI%5D%202%20a%20Data%20Quality%20d76b695c89374526a152b27554c80542/Screenshot_2020-09-18_at_16.31.19.png)

# Knn imputation: y qualitative variable

Find the closest individual to *i,* according all available variables except factor *y*

![%5BADEI%5D%202%20a%20Data%20Quality%20d76b695c89374526a152b27554c80542/Screenshot_2020-09-23_at_17.44.04.png](%5BADEI%5D%202%20a%20Data%20Quality%20d76b695c89374526a152b27554c80542/Screenshot_2020-09-23_at_17.44.04.png)

# Data Quality report

- Per variable, count:
    - Number of missing values
    - Number of errors (including inconsistencies)
    - Number of outliers
    - Rank variables according the sum of missing values (and errors).
- Per individuals, count:
    - number of missing values
    - number of errors,
    - number of outliers
    - Create a new variable adding the total number missing values (and errors).
    - Describe this variable, *to which other variables exist higher associations*.
        - Compute the correlation with all other variables. Rank these variables according the correlation
        - Compute for every group of individuals (group of age, size of town, singles, married, ...) the mean of missing values. Rank the groups according the computed mean.

# ***Multivariate outliers***

*But outliers are multivariate*

Univariate detection of outliers doesn’t imply multivariate detection

![%5BADEI%5D%202%20a%20Data%20Quality%20d76b695c89374526a152b27554c80542/Screenshot_2020-09-23_at_17.45.09.png](%5BADEI%5D%202%20a%20Data%20Quality%20d76b695c89374526a152b27554c80542/Screenshot_2020-09-23_at_17.45.09.png)

Then, detection of outliers is based in computing distances to the central point of data, by means an Iterative algorithm

![%5BADEI%5D%202%20a%20Data%20Quality%20d76b695c89374526a152b27554c80542/Screenshot_2020-09-23_at_17.45.27.png](%5BADEI%5D%202%20a%20Data%20Quality%20d76b695c89374526a152b27554c80542/Screenshot_2020-09-23_at_17.45.27.png)

# ***Mahalanobis Distance vs. Euclidean distance***

![%5BADEI%5D%202%20a%20Data%20Quality%20d76b695c89374526a152b27554c80542/Screenshot_2020-09-23_at_17.45.47.png](%5BADEI%5D%202%20a%20Data%20Quality%20d76b695c89374526a152b27554c80542/Screenshot_2020-09-23_at_17.45.47.png)

# ***Detection of multivariate outliers***

Take a value of *h* (size of data assumed not containing outliers), h must be *> p* (number of variables). Usual values = *0.75n* (at most 25% of outliers)

Initialization of an estimation of *G* and *V* : *G* = mean of variables. *V* = matrix of variances

1. Compute the Mahalanobis distances $*D^2_M (i,G)$* for each point *i*.
2. Rank the $*D^2_M (i,G)$* and retain the *h* individuals with lower $*D^2_M (i,G)*$
3. Update *G* and *V* till convergence.

Plot the final “robustified” Mahalanobis distances with the initial Mahalanobis distances to detect the outliers **mvoutlier** library and method `aq.plot()`

![%5BADEI%5D%202%20a%20Data%20Quality%20d76b695c89374526a152b27554c80542/Screenshot_2020-09-23_at_17.59.26.png](%5BADEI%5D%202%20a%20Data%20Quality%20d76b695c89374526a152b27554c80542/Screenshot_2020-09-23_at_17.59.26.png)